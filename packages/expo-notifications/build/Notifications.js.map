{"version":3,"file":"Notifications.js","sourceRoot":"","sources":["../src/Notifications.ts"],"names":[],"mappings":"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","sourcesContent":["import Constants from 'expo-constants';\nimport { EventEmitter, EventSubscription } from 'fbemitter';\nimport invariant from 'invariant';\nimport { AsyncStorage, Platform } from 'react-native';\nimport { CodedError, RCTDeviceEventEmitter, UnavailabilityError } from '@unimodules/core';\nimport ExpoNotifications from './ExpoNotifications';\nimport { Mailbox } from './Mailbox';\nimport {\n  ForegroundNotification,\n  Notification,\n  Channel,\n  ActionType,\n  UserInteraction,\n  OnUserInteractionListener,\n  OnForegroundNotificationListener,\n  OnTokenChangeListener,\n  Subscription,\n} from './Notifications.types';\n\nconst _mailbox: Mailbox = new Mailbox();\n\nlet isItFirstListener: boolean = true;\n\nfunction _processNotification(notification) {\n  notification = Object.assign({}, notification);\n\n  if (!notification.data) {\n    notification.data = {};\n  }\n\n  if (notification.hasOwnProperty('count')) {\n    delete notification.count;\n  }\n\n  // Delete any Android properties on iOS and merge the iOS properties on root notification object\n  if (Platform.OS === 'ios') {\n    if (notification.android) {\n      delete notification.android;\n    }\n\n    if (notification.ios) {\n      notification = Object.assign(notification, notification.ios);\n      notification.data._displayInForeground = notification.ios._displayInForeground;\n      delete notification.ios;\n    }\n  }\n\n  // Delete any iOS properties on Android and merge the Android properties on root notification\n  // object\n  if (Platform.OS === 'android') {\n    if (notification.ios) {\n      delete notification.ios;\n    }\n\n    if (notification.android) {\n      notification = Object.assign(notification, notification.android);\n      delete notification.android;\n    }\n  }\n\n  return notification;\n}\n\nfunction _validateNotification(notification) {\n  if (Platform.OS === 'ios') {\n    invariant(\n      !!notification.title && !!notification.body,\n      'Local notifications on iOS require both a title and a body'\n    );\n  } else if (Platform.OS === 'android') {\n    invariant(!!notification.title, 'Local notifications on Android require a title');\n  }\n}\n\n// User passes set of actions titles.\nexport async function createCategoryAsync(categoryId: string, actions: ActionType[]): Promise<void> {\n  return ExpoNotifications.createCategoryAsync(categoryId, actions);\n}\n\nexport async function deleteCategoryAsync(categoryId: string): Promise<void> {\n  return ExpoNotifications.deleteCategoryAsync(categoryId);\n}\n\nexport async function createChannelAsync(id: string, channel: Channel): Promise<void> {\n  if (Platform.OS !== 'android') {\n    console.warn(`createChannelAndroidAsync(...) has no effect on ${Platform.OS}`);\n    return;\n  }\n  return ExpoNotifications.createChannelAsync(id, channel);\n}\n\nexport async function deleteChannelAsync(id: string): Promise<void> {\n  if (Platform.OS !== 'android') {\n    console.warn(`deleteChannelAndroidAsync(...) has no effect on ${Platform.OS}`);\n    return;\n  }\n  return ExpoNotifications.deleteChannelAsync(id);\n}\n\nexport async function createChannelGroupAsync(groupId: string, groupName: string): Promise<void> {\n  if (Platform.OS !== 'android') {\n    console.warn(`createChannelGroupAsync(...) has no effect on ${Platform.OS}`);\n    return;\n  }\n  return ExpoNotifications.createChannelGroupAsync(groupId, groupName);\n}\n\nexport async function deleteChannelGroupAsync(groupId: string): Promise<void> {\n  if (Platform.OS !== 'android') {\n    console.warn(`deleteChannelGroupAsync(...) has no effect on ${Platform.OS}`);\n    return;\n  }\n  return ExpoNotifications.deleteChannelGroupAsync(groupId);\n}\n\n/**\n * @remarks\n * Shows a notification instantly\n */\n\nexport async function presentLocalNotificationAsync(\n  notification: Notification\n): Promise<string> {\n  _validateNotification(notification);\n  let nativeNotification = _processNotification(notification);\n  return await ExpoNotifications.presentLocalNotificationAsync(nativeNotification);\n}\n\n/**\n * @remarks\n * Dismiss currently shown notification with ID (Android only)\n */\nexport async function dismissNotificationAsync(notificationId: string): Promise<void> {\n  if (!ExpoNotifications.dismissNotificationAsync) {\n    throw new UnavailabilityError('Expo.Notifications', 'dismissNotification');\n  }\n  return await ExpoNotifications.dismissNotificationAsync(notificationId);\n}\n/**\n * @remarks\n * Dismiss all currently shown notifications (Android only)\n */\nexport async function dismissAllNotificationsAsync(): Promise<void> {\n  if (!ExpoNotifications.dismissAllNotificationsAsync) {\n    throw new UnavailabilityError('Expo.Notifications', 'dismissAllNotifications');\n  }\n  return await ExpoNotifications.dismissAllNotificationsAsync();\n}\n/**\n * @remarks\n * Cancel scheduled notification notification with ID\n */\nexport async function cancelScheduledNotificationAsync(\n  notificationId: string\n): Promise<void> {\n  return ExpoNotifications.cancelScheduledNotificationAsync(notificationId);\n}\n\n/**\n * @remarks\n * Cancel all scheduled notifications\n */\nexport async function cancelAllScheduledNotificationsAsync(): Promise<void> {\n  return ExpoNotifications.cancelAllScheduledNotificationsAsync();\n}\n\nexport async function setBadgeNumberAsync(number: number): Promise<void> {\n  if (!ExpoNotifications.setBadgeNumberAsync) {\n    throw new UnavailabilityError('Expo.Notifications', 'setBadgeNumberAsync');\n  }\n  if (Platform.OS !== 'ios') {\n    return;\n  }\n  return ExpoNotifications.setBadgeNumberAsync(number);\n}\n\nexport async function setOnTokenChangeListenerAsync(listener: OnTokenChangeListener): Promise<void> {\n  _mailbox.setOnTokenChangeListener(listener);\n  await ExpoNotifications.registerForPushNotificationsAsync();\n}\n\nexport function addOnUserInteractionListener(listener: OnUserInteractionListener): Subscription {\n  const subscription: Subscription = _mailbox.addOnUserInteractionListener(listener);\n  if (isItFirstListener) {\n    isItFirstListener = true;\n    setTimeout( async () => {\n        ExpoNotifications.flushPendingUserInteractionsAsync();\n    }, 0);\n  }\n  return subscription;\n}\n\nexport function addOnForegroundNotificationListener(listener: OnForegroundNotificationListener): Subscription {\n  return _mailbox.addOnForegroundNotificationListener(listener);\n}\n\nexport async function scheduleNotificationWithCalendarAsync(\n  notification: Notification,\n  options: {\n    year?: number;\n    month?: number;\n    hour?: number;\n    day?: number;\n    minute?: number;\n    second?: number;\n    weekDay?: number;\n    repeat?: boolean;\n  } = {}\n): Promise<string> {\n  const areOptionsValid: boolean =\n    (options.month == null || isInRangeInclusive(options.month, 1, 12)) &&\n    (options.day == null || isInRangeInclusive(options.day, 1, 31)) &&\n    (options.hour == null || isInRangeInclusive(options.hour, 0, 23)) &&\n    (options.minute == null || isInRangeInclusive(options.minute, 0, 59)) &&\n    (options.second == null || isInRangeInclusive(options.second, 0, 59)) &&\n    (options.weekDay == null || isInRangeInclusive(options.weekDay, 0, 7)) &&\n    (options.weekDay == null || options.day == null);\n\n  if (!areOptionsValid) {\n    throw new CodedError(\n      'WRONG_OPTIONS',\n      'Options in scheduleNotificationWithCalendarAsync call were incorrect!'\n    );\n  }\n  \n  if (options.weekDay == 0) {\n    options.weekDay = 7;\n  }\n\n  _validateNotification(notification);\n  const nativeNotification = _processNotification(notification);\n  return ExpoNotifications.scheduleNotificationWithCalendarAsync(nativeNotification, options);\n}\n\nexport async function scheduleNotificationWithTimerAsync(\n  notification: Notification,\n  options: {\n    interval: number;\n    repeat?: boolean;\n  }\n): Promise<string> {\n  if (options.interval < 1) {\n    throw new CodedError('WRONG_OPTIONS', 'Interval must be not less then 1');\n  }\n  _validateNotification(notification);\n  const nativeNotification = _processNotification(notification);\n  return ExpoNotifications.scheduleNotificationWithTimerAsync(nativeNotification, options);\n}\n\nfunction isInRangeInclusive(variable: number, min: number, max: number): boolean {\n  return variable >= min && variable <= max;\n}\n"]}